version: '3.7'

services:
    akhq:
        image: tchiotludo/akhq
        environment:
            AKHQ_CONFIGURATION: |
                akhq:
                  connections:
                    docker-kafka-server:
                      properties:
                        bootstrap.servers: "kafka:9092"
                      schema-registry:
                        url: "http://schema-registry:8083"
        ports:
            - "8085:8080"
        links:
            - kafka
            - schema-registry

    kafka:
        image: confluentinc/cp-kafka:latest
        depends_on:
            - zookeeper
        ports:
            - "29092:29092"
        environment:
            KAFKA_BROKER_ID: '0'
            KAFKA_ZOOKEEPER_CONNECT: "zookeeper:2181"
            KAFKA_ADVERTISED_LISTENERS: "EXTERNAL://localhost:29092,PLAINTEXT://kafka:9092"
            KAFKA_NUM_PARTITIONS: '12'
            KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1
            KAFKA_AUTO_CREATE_TOPICS_ENABLE: 'true'
            KAFKA_AUTHORIZER_CLASS_NAME: 'kafka.security.authorizer.AclAuthorizer'
            KAFKA_ALLOW_EVERYONE_IF_NO_ACL_FOUND: 'true'
            KAFKA_COMPRESSION_TYPE: 'gzip'
            KAFKA_TRANSACTION_STATE_LOG_REPLICATION_FACTOR: '1'
            KAFKA_TRANSACTION_STATE_LOG_MIN_ISR: '1'
            KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: 'PLAINTEXT:PLAINTEXT,EXTERNAL:PLAINTEXT'
            KAFKA_CONFLUENT_SUPPORT_METRICS_ENABLE: 'false'
            KAFKA_JMX_PORT: '9091'

    schema-registry:
        image: confluentinc/cp-schema-registry:latest
        depends_on:
            - kafka
        environment:
            SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: "PLAINTEXT://kafka:9092"
            SCHEMA_REGISTRY_HOST_NAME: "schema-registry"
            SCHEMA_REGISTRY_LISTENERS: "http://0.0.0.0:8083"
            SCHEMA_REGISTRY_LOG4J_ROOT_LOGLEVEL: "INFO"
        ports:
            - "8083:8083"

    zookeeper:
        image: confluentinc/cp-zookeeper:latest
        ports:
            - "2181:2181"
        environment:
            ZOOKEEPER_CLIENT_PORT: 2181
            ZOOKEEPER_ADMIN_ENABLE_SERVER: "false"

    postgres:
        image: postgres
        ports:
            - 5432:5432
        environment:
            POSTGRES_USER: admin
            POSTGRES_PASSWORD: admin
            POSTGRES_DB: exampledb

    pgadmin:
        image: dpage/pgadmin4
        ports:
          - "8001:8001"
        environment:
          PGADMIN_DEFAULT_EMAIL: admin@admin.com
          PGADMIN_DEFAULT_PASSWORD: admin
          PGADMIN_LISTEN_PORT: 8001
        depends_on:
          - postgres